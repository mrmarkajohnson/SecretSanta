function initDataLists(){if(isEdge)return!0;let n=document.querySelectorAll("input[list]");n.forEach(handleDataListIssues)}function handleDataListIssues(n){function r(){if(isEmptyInput(n))isFirefox&&n.setAttribute("placeholder",t+" (click again to select)");else{let t=n.value;n.setAttribute("placeholder",t);n.value=""}}function u(){let r=n.getAttribute("placeholder");n.value==""&&r!=t&&(n.value=r,i())}function i(){n.setAttribute("placeholder",t)}let t=n.getAttribute("placeholder");isEmptyValue(t)&&(t=dataListStandardPlaceholder);n.setAttribute("placeholder",t);["focus","mousedown"].forEach(function(t){n.addEventListener(t,function(){r()})});n.addEventListener("blur",function(){u()});n.addEventListener("input",function(){i()})}function initDeleteLinks(){let n=document.querySelectorAll("a.delete-link");n.forEach(initDeleteLink)}function initDeleteLink(n){n.getAttribute("data-initialised")||(n.setAttribute("data-initialised",!0),n.addEventListener("click",function(){confirmAndDelete(n)}))}function confirmAndDelete(n){async function r(n){let r=n.getAttribute("data-url"),u=new URL(r),t=await fetch(u.href,{method:"POST",redirect:"follow"});await t;document.dispatchEvent(new Event("ajaxComplete"));let i=await t.text();t.redirected?window.location.href=t.url:t.ok&&reloadGrid();t.redirected||i==null||i==""||(t.ok?showSuccessMessage(i):showErrorMessage(i))}let t=n.getAttribute("data-confirm-title")??"Delete this item",i=n.getAttribute("data-confirm-message")??"Are you sure?";bootbox.confirm({title:t,message:i,buttons:{confirm:{label:"Yes",className:"btn-success"},cancel:{label:"No",className:"btn-no"}},callback:function(t){bootbox.hideAll();t&&r(n)}})}function showErrorMessage(n){toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:1e3,hideDuration:1e3,timeOut:2e3,extendedTimeOut:100,showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};toastr.error(n)}async function submitFormViaFetch(n,t){isEmptyValue(t)&&(t=n.getAttribute("action"));let r=new FormData(n),i=await fetch(t,{method:"POST",body:r,redirect:"follow"}),u=i.clone();if(i.status>400)showErrorMessage("Unknown error, please contact an administrator");else if(i.redirected)window.location.href=i.url;else{let t=await getResponseText(i);if(isHtml(t))if(t.includes("<form")){let i=new DOMParser,r=i.parseFromString(t,"text/html"),u=r.querySelector("form");n.innerHTML=u.innerHTML}else n.innerHTML=t}return document.dispatchEvent(new Event("ajaxComplete")),u}function reloadGrid(){let n=new MvcGrid(document.querySelector(".mvc-grid"));n.reload()}function initModalLinks(){let n=document.querySelectorAll("a.modal-link");n.forEach(initModalLink)}function initModalLink(n){n.getAttribute("data-initialised")||(n.setAttribute("data-initialised",!0),n.addEventListener("click",function(){showModal(n)}))}async function showModal(n){let r=n.getAttribute("data-url"),u=new URL(r),t=await fetch(u.href,{method:"GET"});await t;let i=await t.text();t.ok?(showModalResponse(i),document.dispatchEvent(new Event("ajaxComplete"))):showErrorMessage(i)}function showModalResponse(n){let t=document.getElementById("modalContainer");t?(t.removeEventListener("hidden.bs.modal",modalClosed),t.innerHTML=n):(document.body.insertAdjacentHTML("afterbegin",'<div id="modalContainer">'+n+"<\/div>"),t=document.getElementById("modalContainer"));let i=t.querySelector("div.modal"),r=new bootstrap.Modal(i);t.addEventListener("hidden.bs.modal",modalClosed);document.dispatchEvent(new CustomEvent("modalOpening",{detail:{modal:i}}));let u=i.querySelector(".btn-save-close-modal");!u||u.addEventListener("click",function(){saveModalForm(i,r)});r.show()}function modalClosed(n){let t=n.target;t&&(document.activeElement&&document.activeElement.blur(),document.dispatchEvent(new CustomEvent("modalClosed",{detail:{modal:t}})),document.querySelectorAll(".modal-backdrop").forEach(function(n){n.remove()}))}async function saveModalForm(n,t){function u(i){showSuccessMessage(i);t.hide();document.dispatchEvent(new CustomEvent("modalSaved",{detail:{modal:n}}))}let f=n.querySelector("form"),r=await submitFormViaFetch(f),i=await getResponseText(r);if(r.ok)if(isHtml(i)){let n=getSuccessMessage();isEmptyValue(n)||u(n)}else isEmptyValue(i)||u(i),t.hide();else isEmptyValue(i)||isHtml(i)||showErrorMessage(i)}function initPopper(){$('[data-toggle="popover"]').popover();$('[data-toggle="tooltip"]').tooltip()}function initSuccessMessage(){let n=getSuccessMessage();if(isEmptyValue(n)){let n=window.location.href;n.includes(successMessageUrlStart)&&handleSuccessFromUrl(n)}else removeSuccessMessageFromUrl(n,!1),showSuccessMessage(n)}function getSuccessMessage(){let n=document.getElementById("successMessage");return notEmptyInput(n)?n.value:""}function handleSuccessFromUrl(n){try{let u=n.indexOf(successMessageUrlStart)+successMessageUrlStart.length,t=n.substring(u),i="",r=t.substring(0,t.indexOf("&"));i=isEmptyValue(r)?t:r;removeSuccessMessageFromUrl(i,!0);try{let n=decodeURIComponent(i);showSuccessMessage(n)}catch{console.log("Showing success message failed")}}catch{console.log("Success message handling failed")}}function removeSuccessMessageFromUrl(n,t){let i=window.location.href,r=successMessageUrlStart+(t?n:encodeURIComponent(n));try{i.includes(r)&&(i.includes("?"+r)?(i=i.replace("?"+r,""),window.history.replaceState({},null,i)):i.includes("&"+r)&&(i=i.replace("&"+r,""),window.history.replaceState({},null,i)))}catch{}}function showSuccessMessage(n){toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-right",preventDuplicates:!0,onclick:null,showDuration:1e3,hideDuration:1e3,timeOut:2e3,extendedTimeOut:100,showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};toastr.success(n)}function initSummernote(){let n=$("div.summernote");if(!n.attr("initialised-sn")){n.attr("initialised-sn",!0);let i=n.parent().closest("div"),t=i.find("input.summernote-content"),r=t.val()??"";n.summernote({placeholder:"",tabsize:2,height:100,toolbar:[["font",["bold","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link",]],]});n.summernote("code",r);let u=i.find(".note-editable.card-block");u.on("change, blur",function(){let i=n.summernote("code");t.val(i);t.attr("value",i)})}}function initThinking(){function i(t){let r=$(t),i=null;t.addEventListener("submit",function(t){(typeof $.fn.valid!="function"||r.valid())&&(i=t.currentTarget,i.setAttribute("disabled","disabled"),showThinkingAnimation(n,i))},{passive:!0});$("form").on("invalid-form.validate",function(){clearThinkingElements(n,i)})}let n=document.querySelector(".thinking");clearThinkingElements(n,null);window.addEventListener("beforeunload",function(){clearThinkingElements(n,null);showThinkingAnimation(n,null)});var t=document.querySelectorAll("form");t.forEach(i)}function showThinkingAnimation(n,t){submitTimer=setTimeout(function(){n.style.display="block";t&&t.removeAttribute("disabled")},200)}function clearThinkingElements(n,t){submitTimer&&clearTimeout(submitTimer);n.style.display="none";t&&t.removeAttribute("disabled")}async function selectUser(n,t){let u=n.getAttribute("data-hashed-user-id");t.searchParams.set("hashedUserId",u);let i=await fetch(t.href,{method:"POST",redirect:"follow"});await i;document.dispatchEvent(new Event("ajaxComplete"));let r=await i.text();i.redirected?window.location.href=i.url:r!=null&&r!=""&&(i.ok?showSuccessMessage(r):showErrorMessage(r))}function initEyeSymbols(){let n=document.querySelectorAll(".fa-eye");n.forEach(initEyeSymbol)}function initEyeSymbol(n){function i(n,t,i){t?n.type=i?"text":"password":i?n.classList.remove(hideTextClass):n.classList.add(hideTextClass)}let t=n.closest(".input-group");if(t){let r=t.querySelector("input[type=password], input."+hideTextClass);if(r){let o=r.type=="password",f=!1,u=t.querySelector(".fa-eye-slash");for(e of["change","keyup","paste","input"])r.addEventListener(e,h);s(n);r.addEventListener("blur",function(){f=!1;i(r,o,f);n.classList.add("collapse");u&&u.classList.add("collapse")});r.addEventListener("focus",function(){isEmptyInput(r)||f||(n.classList.remove("collapse"),u&&u.classList.add("collapse"))});function h(){isEmptyInput(r)?f?u&&u.classList.add("collapse"):n.classList.add("collapse"):f?u&&u.classList.remove("collapse"):n.classList.remove("collapse")}function c(){return f?l():a(),!1}function l(){f=!1;i(r,o,f);n.classList.remove("collapse");u&&u.classList.add("collapse")}function a(){if(f=!0,i(r,o,f),n.classList.add("collapse"),u)u.classList.remove("collapse");else{u=document.createElement("i");u.setAttribute("class","fa fa-eye-slash");let t=n.closest(".input-group-text");t.append(u);s(u)}}function s(n){n.addEventListener("mousedown",function(n){n.preventDefault();n.stopPropagation();c()})}}}}let dataListStandardPlaceholder="Please type or select a value";document.addEventListener("reloadstart",function(n){let i=n.detail.grid.element.id,t=document.getElementById(i);!!t&&isEmptyValue(t.innerHTML)&&t.insertAdjacentHTML("afterbegin","<i>Loading, please wait...<\/i>")});document.addEventListener("click",function(n){try{if(n.target&&n.target.classList&&n.target.classList.contains("grid-content-refresh")){let t=n.target.closest(".mvc-grid");if(t){let n=new MvcGrid(t);n.reload()}}}catch{console.log("Grid reload failed")}});let isFirefox=navigator.userAgent.toLowerCase().includes("firefox"),isEdge=navigator.userAgent.toLowerCase().includes("edge");window.addEventListener("load",function(){initPopper();initSuccessMessage();initEyeSymbols();initDataLists();initThinking();initModalLinks();initDeleteLinks()});$(document).on("ajaxComplete",function(){initPopper();initEyeSymbols();initDataLists();initThinking();initModalLinks();initDeleteLinks()});document.addEventListener("reloadend",function(){initPopper();initModalLinks();initDeleteLinks()});let successMessageUrlStart="successMessage=";let submitTimer=null;let hideTextClass="hide-text";
//# sourceMappingURL=global.min.js.map